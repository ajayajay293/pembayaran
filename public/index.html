<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARR PAYMENT | Official</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        #qrcode img { margin: auto; border-radius: 1.5rem; padding: 12px; background: white; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="max-w-md w-full glass rounded-[2.5rem] p-8 text-center animate__animated animate__fadeInUp">
        <div class="mb-4 text-5xl">üíé</div>
        <h1 class="text-2xl font-black italic text-cyan-400">JARR PAYMENT</h1>
        <p class="text-[10px] text-slate-500 font-bold tracking-widest uppercase mb-6">Automated Gateway</p>

        <div id="view-input" class="space-y-4">
            <input type="number" id="amt" placeholder="Nominal (Min 1.000)" class="w-full bg-slate-900 border border-white/10 p-5 rounded-2xl text-xl font-bold text-center outline-none focus:border-cyan-500">
            <button onclick="proses()" id="btn" class="w-full py-5 bg-cyan-600 rounded-2xl font-black uppercase shadow-lg">Bayar Sekarang</button>
        </div>

        <div id="view-checkout" class="hidden space-y-6">
            <div id="qrcode"></div>
            
            <div class="bg-black/40 p-5 rounded-2xl border border-white/5 space-y-2 text-left">
                <div class="flex justify-between">
                    <span class="text-xs text-slate-500">Total</span>
                    <span id="disp-amt" class="font-bold text-cyan-400"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-xs text-slate-500">ID TRX</span>
                    <span id="disp-id" class="text-[10px] font-mono"></span>
                </div>
            </div>

            <div class="text-yellow-500 text-xs animate-pulse font-bold italic">
                ‚è≥ Menunggu Pembayaran...
            </div>
        </div>
    </div>

    <script>
        async function proses() {
            const nominal = document.getElementById('amt').value;
            if(!nominal || nominal < 1000) return Swal.fire('Error', 'Minimal 1.000', 'error');

            document.getElementById('btn').innerText = 'Loading...';
            
            try {
                // Memanggil rute yang ada di index.js
                const res = await axios.post('/api/create', { nominal });
                if(res.data.status) {
                    const d = res.data.data;
                    document.getElementById('view-input').classList.add('hidden');
                    document.getElementById('view-checkout').classList.remove('hidden');
                    document.getElementById('disp-amt').innerText = 'Rp ' + parseInt(d.nominal).toLocaleString();
                    document.getElementById('disp-id').innerText = d.id;

                    new QRCode(document.getElementById("qrcode"), { text: d.qr_string, width: 200, height: 200 });

                    // Cek Status Otomatis
                    const interval = setInterval(async () => {
                        const s = await axios.post('/api/status', { id: d.id });
                        if(s.data.data.status === 'success') {
                            clearInterval(interval);
                            Swal.fire({
                                icon: 'success',
                                title: 'SUKSES!',
                                text: 'Pembayaran Diterima. Mengalihkan...',
                                showConfirmButton: false,
                                timer: 2000
                            }).then(() => {
                                // REDIRECT KE TELEGRAM ANDA
                                window.location.href = "https://t.me/jarrGanteng";
                            });
                        }
                    }, 3000);
                }
            } catch (e) {
                Swal.fire('Error', 'Cek Saldo / IP Atlantic!', 'error');
                document.getElementById('btn').innerText = 'Bayar Sekarang';
            }
        }
    </script>
</body>
</html>
